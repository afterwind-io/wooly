继承关系：
`Entity` < `CanvasItem`

## `Engine`

### 更新(Update)

沿根`Entity`进行深度优先遍历，调用各节点的`$Update`方法。

### 渲染(Draw)

沿`CanvasTree`正序遍历，调用各节点的`$Draw`方法。

## `CanvasItem`

普通树结构，包含深度递归优先顺序的链表结构，用于表达实际的对象结构。

### `siblingIndex`

表达该节点在父级节点子代中的先后顺序，用于渲染层级比较。

**该值与其在父级节点`children`中的索引位置不一定对应。**

### `ZIndex`

表达该节点在全局的渲染层级。值越大，层级越高。

> 渲染层级：即图形显示的叠放次序。值越大，即叠放次序越靠后。如果元素之间有重叠，叠放次序靠后的元素会覆盖在靠前的元素之上。

在最终渲染层级计算时，`ZIndex`取的是自身的值+所有父级节点的值之和。如此一来在递归`CanvasItem`插入`CanvasTree`时，如果该`CanvasItem`具有不为`0`的`ZIndex`，则其子代会“继承”到该值，并且其子代的渲染层级会自然大于其本身。这样设计确保了在遍历`CanvasTree`进行渲染时，只需要渲染节点`CanvasItem`本身，而不需要继续遍历该`CanvasItem`的子代。

## `CanvasTree`

红黑树结构，用于表达渲染层级，节点值为`CanvasItem`。节点渲染层级越高，在树中越靠右。

### 插入节点

在向`CanvasTree`插入`CanvasItem`时，使用如下算法计算各节点的层级：

1. 比较节点的 ZIndex，值较大者层级更高；
2. 如果 ZIndex 相等，并且某一节点是另一节点的子代，则子代层级更高，否则，
3. 比较双方在最小共同祖先下一级的祖先的`siblingIndex`，值较大者层级更高；

其余与红黑树插入流程一致。

### 删除节点

与红黑树删除流程一致。

## 鼠标事件检测与冒泡

1. 倒序遍历`CanvasTree`，检查每个节点是否产生相应的鼠标事件
   - 如果有，检查节点是否具有`ignorePointer`标记
     - 如果`ignorePointer`为`true`，则返回步骤`1`，从下一节点继续遍历，否则，
     - 中断`CanvasTree`遍历，触发节点的`_Input`事件，并且沿`CanvasItem`结构向上冒泡
   - 如果没有，则返回步骤`1`，从下一节点继续遍历
